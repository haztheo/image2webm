var WhammyCrs,Whammy;!function(e){var a=function(e){this.message=e};a.prototype=new Error,a.prototype.name="InvalidCharacterError";var t=function(e){throw new a(e)},r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=/[\t\n\f\r ]/g,i=function(e){e=String(e).replace(n,"");var a=e.length;a%4==0&&(e=e.replace(/==?$/,""),a=e.length),(a%4==1||/[^+a-zA-Z0-9\/]/.test(e))&&t("Invalid character: the string to be decoded is not correctly encoded.");for(var o,d,i=0,s="",m=-1;++m<a;)d=r.indexOf(e.charAt(m)),o=i%4?64*o+d:d,i++%4&&(s+=String.fromCharCode(255&o>>(-2*i&6)));return s},o=function(e){e=String(e),/[^\0-\xFF]/.test(e)&&t("The string to be encoded contains characters outside of the Latin1 range.");for(var o,d,s,c,a=e.length%3,n="",i=-1,l=e.length-a;++i<l;)o=e.charCodeAt(i)<<16,d=e.charCodeAt(++i)<<8,s=e.charCodeAt(++i),c=o+d+s,n+=r.charAt(c>>18&63)+r.charAt(c>>12&63)+r.charAt(c>>6&63)+r.charAt(63&c);return 2==a?(o=e.charCodeAt(i)<<8,d=e.charCodeAt(++i),c=o+d,n+=r.charAt(c>>10)+r.charAt(c>>4&63)+r.charAt(c<<2&63)+"="):1==a&&(c=e.charCodeAt(i),n+=r.charAt(c>>2)+r.charAt(c<<4&63)+"=="),n},d={encode:o,decode:i,version:"0.1.0"};"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return d}):e.base64=d}(this),function(){WhammyCrs=function(){var e=this;this.frames=[],this.counterval=0,this.retrival=0,this.framerate=0,this.interaval=null,this.progress=null,this.onConvert=null,this.workers_lenght=5,this.workers=[],this.rotation=0,this.framenumber=0;for(var a=0;a<e.workers_lenght;++a)this.workers.push(new Worker("WhammyWorker.js")),this.workers[a].addEventListener("message",function(a){console.log("message : ",a),++e.retrival,e.onConvert&&e.onConvert(++e.counterval),e.frames[a.data.frame]=a.data.webp},!1)},WhammyCrs.prototype.reset=function(){this.counterval=0,this.rotation=0,this.retrival=0,this.frames=[],this.framerate=0,this.framenumber=0,this.interaval&&clearInterval(this.interaval),this.interaval=null},WhammyCrs.prototype.addFrame=function(e,a,t){var r=this;--this.retrival;var n=r.workers[r.rotation];n.postMessage({imagedata:e,width:a,height:t,frame:r.framenumber}),++r.rotation,++r.framenumber,r.rotation==r.workers_lenght&&(r.rotation=0)},WhammyCrs.prototype.setFrameRate=function(e){this.framerate=e},WhammyCrs.prototype.encodeWEBM=function(e){function t(){clearInterval(a.interaval);var t=new Whammy.fromImageArray(a.frames,a.framerate);a.progress&&a.progress(100),e(t)}var a=this;this.interaval&&clearInterval(this.interaval),this.interaval=null,this.progress&&this.progress(0);var r=300;if(this.retrival<0){var n=-this.retrival;this.interaval=setInterval(function(){a.progress&&a.progress((n+a.retrival)/n*100),a.retrival>=0&&t()},r)}else t()}}();