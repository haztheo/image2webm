var WhammyCrs,Whammy;!function(a){var b=function(a){this.message=a};b.prototype=new Error,b.prototype.name="InvalidCharacterError";var e=function(a){throw new b(a)},d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=/[\t\n\f\r ]/g,c=function(a){a=String(a).replace(i,"");var b=a.length;b%4==0&&(a=a.replace(/==?$/,""),b=a.length),(b%4==1||/[^+a-zA-Z0-9\/]/.test(a))&&e("Invalid character: the string to be decoded is not correctly encoded.");for(var f,t,c=0,n="",r=-1;++r<b;)t=d.indexOf(a.charAt(r)),f=c%4?64*f+t:t,c++%4&&(n+=String.fromCharCode(255&f>>(-2*c&6)));return n},f=function(a){a=String(a),/[^\0-\xFF]/.test(a)&&e("The string to be encoded contains characters outside of the Latin1 range.");for(var f,t,n,o,b=a.length%3,i="",c=-1,h=a.length-b;++c<h;)f=a.charCodeAt(c)<<16,t=a.charCodeAt(++c)<<8,n=a.charCodeAt(++c),o=f+t+n,i+=d.charAt(o>>18&63)+d.charAt(o>>12&63)+d.charAt(o>>6&63)+d.charAt(63&o);return 2==b?(f=a.charCodeAt(c)<<8,t=a.charCodeAt(++c),o=f+t,i+=d.charAt(o>>10)+d.charAt(o>>4&63)+d.charAt(o<<2&63)+"="):1==b&&(o=a.charCodeAt(c),i+=d.charAt(o>>2)+d.charAt(o<<4&63)+"=="),i},t={encode:f,decode:c,version:"0.1.0"};"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return t}):a.base64=t}(this),function(){WhammyCrs=function(){var a=this;this.frames=[],this.counterval=0,this.retrival=0,this.framerate=0,this.interaval=null,this.progress=null,this.onConvert=null,this.workers_lenght=5,this.workers=[],this.rotation=0,this.framenumber=0;for(var b=0;b<a.workers_lenght;++b)this.workers.push(new Worker("WhammyWorker.js")),this.workers[b].addEventListener("message",function(b){console.log("message : ",b),++a.retrival,a.onConvert&&a.onConvert(++a.counterval),a.frames[b.data.frame]=b.data.webp},!1)},WhammyCrs.prototype.reset=function(){this.counterval=0,this.rotation=0,this.retrival=0,this.frames=[],this.framerate=0,this.framenumber=0,this.interaval&&clearInterval(this.interaval),this.interaval=null},WhammyCrs.prototype.addFrame=function(a,b,e,d){var i=this;--this.retrival;var c=i.workers[i.rotation];c.postMessage({imagedata:a,width:b,height:e,frame:i.framenumber,repeatNumber:d}),++i.rotation,++i.framenumber,i.rotation==i.workers_lenght&&(i.rotation=0)},WhammyCrs.prototype.setFrameRate=function(a){this.framerate=a},WhammyCrs.prototype.encodeWEBM=function(a){function e(){clearInterval(b.interaval);var e=new Whammy.fromImageArray(b.frames,b.framerate);b.progress&&b.progress(100),a(e)}var b=this;this.interaval&&clearInterval(this.interaval),this.interaval=null,this.progress&&this.progress(0);var d=300;if(this.retrival<0){var i=-this.retrival;this.interaval=setInterval(function(){b.progress&&b.progress((i+b.retrival)/i*100),b.retrival>=0&&e()},d)}else e()}}();