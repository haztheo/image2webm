var WhammyCrs,Whammy;!function(a){var t=function(a){this.message=a};t.prototype=new Error,t.prototype.name="InvalidCharacterError";var r=function(a){throw new t(a)},e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=/[\t\n\f\r ]/g,n=function(a){a=String(a).replace(i,"");var t=a.length;t%4==0&&(a=a.replace(/==?$/,""),t=a.length),(t%4==1||/[^+a-zA-Z0-9\/]/.test(a))&&r("Invalid character: the string to be decoded is not correctly encoded.");for(var o,d,n=0,s="",h=-1;++h<t;)d=e.indexOf(a.charAt(h)),o=n%4?64*o+d:d,n++%4&&(s+=String.fromCharCode(255&o>>(-2*n&6)));return s},o=function(a){a=String(a),/[^\0-\xFF]/.test(a)&&r("The string to be encoded contains characters outside of the Latin1 range.");for(var o,d,s,f,t=a.length%3,i="",n=-1,c=a.length-t;++n<c;)o=a.charCodeAt(n)<<16,d=a.charCodeAt(++n)<<8,s=a.charCodeAt(++n),f=o+d+s,i+=e.charAt(f>>18&63)+e.charAt(f>>12&63)+e.charAt(f>>6&63)+e.charAt(63&f);return 2==t?(o=a.charCodeAt(n)<<8,d=a.charCodeAt(++n),f=o+d,i+=e.charAt(f>>10)+e.charAt(f>>4&63)+e.charAt(f<<2&63)+"="):1==t&&(f=a.charCodeAt(n),i+=e.charAt(f>>2)+e.charAt(f<<4&63)+"=="),i},d={encode:o,decode:n,version:"0.1.0"};"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return d}):a.base64=d}(this),function(){WhammyCrs=function(){var a=this;this.frames=[],this.counterval=0,this.retrival=0,this.framerate=0,this.interaval=null,this.progress=null,this.onConvert=null,this.workers_lenght=5,this.workers=[],this.rotation=0,this.framenumber=0;for(var t=0;t<a.workers_lenght;++t)this.workers.push(new Worker("WhammyWorker.js")),this.workers[t].addEventListener("message",function(t){++a.retrival,a.onConvert&&a.onConvert(++a.counterval),a.frames[t.data.frame]=t.data.webp},!1)},WhammyCrs.prototype.reset=function(){this.counterval=0,this.rotation=0,this.retrival=0,this.frames=[],this.framerate=0,this.framenumber=0,this.interaval&&clearInterval(this.interaval),this.interaval=null},WhammyCrs.prototype.addFrame=function(a,t,r){var e=this;--this.retrival;var i=e.workers[e.rotation];i.postMessage({imagedata:a,width:t,height:r,frame:e.framenumber}),++e.rotation,++e.framenumber,e.rotation==e.workers_lenght&&(e.rotation=0)},WhammyCrs.prototype.setFrameRate=function(a){this.framerate=a},WhammyCrs.prototype.encodeWEBM=function(a){function r(){clearInterval(t.interaval);var r=new Whammy.fromImageArray(t.frames,t.framerate);t.progress&&t.progress(100),a(r)}var t=this;this.interaval&&clearInterval(this.interaval),this.interaval=null,this.progress&&this.progress(0);var e=300;if(this.retrival<0){var i=-this.retrival;this.interaval=setInterval(function(){t.progress&&t.progress((i+t.retrival)/i*100),t.retrival>=0&&r()},e)}else r()}}();