function readURL(e){if(e.files&&e.files[0]){var t=new FileReader;t.onload=function(e){var o=t.result;console.log("url : ",o),makeVideo(o)},console.log(e.files[0]);var o=e.files[0].name.split(".")[0]+".webm";document.getElementById("download").setAttribute("download",o),t.readAsDataURL(e.files[0])}}function returnHeightWidth(e,t){var o=e.width,n=e.height;if(isChrome)t(o,n);else{console.log("The width of the image is "+o+"px."),console.log("The height of the image is "+n+"px.");if(n>o){if(n>1280){var a=1280/n;o=Math.floor(a*o),n=1280}}else if(o>1280){a=1280/o;n=Math.floor(n*a),o=1280}t(o,n)}}function toggleCompression(){compress_stuff=!compress_stuff}function grabImageVideo(e,t){var o=new Image;o.onload=function(){returnHeightWidth(o,function(e,n){o.width=e,o.height=n;var a=document.getElementById("canvas");a.width=e,a.height=n;var i=a.getContext("2d");if(i.fillStyle="black",i.fillRect(0,0,a.width,a.height),i.globalAlpha=1,i.drawImage(o,0,0,a.width,a.height),compress_stuff){var d=isChrome?1:.1;console.log("quality : ",d);var m=a.toDataURL("image/jpeg",d),l=new Image;l.onload=function(){i.drawImage(l,0,0,a.width,a.height),t(i,a)},l.src=m}else t(i,a)})},o.src=e}function grabFrame(e,t){grabImageVideo(e,function(e,o){var n=isChrome?whammy_:whammy_cross,a=o.width,i=o.height;if(isChrome)n.add(e,1e3),n.add(e,1e3),n.add(e,1e3);else{n.setFrameRate(framerate);var d=e.getImageData(0,0,a,i).data;n.addFrame(d,a,i,3)}t()})}function makeVideo(e){console.log("is chrome: ",isChrome),isChrome?whammy_=new Whammy.Video:((whammy_cross=new WhammyCrs).reset(),whammy_cross.progress=function(e){console.log("progress : ",e)}),grabFrame(e,function(){isChrome?(console.log("can handle web p"),whammy_.compile(void 0,function(e){console.log("videoBlob : ",e);var t=window.URL.createObjectURL(e);document.getElementById("awesome").src=t,document.getElementById("download").style.display="",document.getElementById("donut").style.display="none",document.getElementById("download").href=t})):(console.warn("cannot handle web p"),whammy_cross.encodeWEBM(function(e){var t=window.URL.createObjectURL(e);document.getElementById("awesome").src=t,document.getElementById("download").style.display="",document.getElementById("donut").style.display="none",document.getElementById("download").href=t}))})}!function(){var e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;window.requestAnimationFrame=e}();var fbutton=document.getElementById("fbutton"),files=document.getElementById("filesinput");fbutton.addEventListener("click",function(){document.getElementById("filesinput").click()},!1),files.addEventListener("change",function(e){document.getElementById("awesome").src="",document.getElementById("download").style.display="none",document.getElementById("download").href="",filesarr=e.target.files,document.getElementById("donut").style.display="inline-block",readURL(e.target)},!1);var compress_stuff=!1,whammy_cross=null,whammy_=null,framerate=1,frames=[],webpUrlRegex=/^data:image\/webp;base64,/gi,isChrome=webpUrlRegex.test(document.createElement("canvas").toDataURL("image/webp"));