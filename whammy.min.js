window.Whammy=function(){function t(t,e){for(var r=a(t),n=3e4,i=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:g(r.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:r.width,id:176},{data:r.height,id:186}]}]}]},{id:475249515,data:[]}]}],d=i[1],f=d.data[2],u=0,s=0;u<t.length;){var c={id:187,data:[{data:Math.round(s),id:179},{id:183,data:[{data:1,id:247},{data:0,size:8,id:241}]}]};f.data.push(c);var v=[],l=0;do v.push(t[u]),l+=t[u].duration,u++;while(u<t.length&&n>l);var m=0,p={id:524531317,data:[{data:Math.round(s),id:231}].concat(v.map(function(t){var a=h({discardable:0,frame:t.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(m)});return m+=t.duration,{data:a,id:163}}))};d.data.push(p),s+=l}for(var w=0,y=0;y<d.data.length;y++){y>=3&&(f.data[y-3].data[1].data[1].data=w);var b=o([d.data[y]],e);w+=b.size||b.byteLength||b.length,2!=y&&(d.data[y]=b)}return o(i,e)}function a(t){for(var a=t[0].width,e=t[0].height,r=t[0].duration,n=1;n<t.length;n++){if(t[n].width!=a)throw"Frame "+(n+1)+" has a different width";if(t[n].height!=e)throw"Frame "+(n+1)+" has a different height";if(t[n].duration<0||t[n].duration>32767)throw"Frame "+(n+1)+" has a weird duration (must be between 0 and 32767)";r+=t[n].duration}return{duration:r,width:a,height:e}}function e(t){for(var a=[];t>0;)a.push(255&t),t>>=8;return new Uint8Array(a.reverse())}function r(t,a){for(var e=new Uint8Array(a),r=a-1;r>=0;r--)e[r]=255&t,t>>=8;return e}function n(t){for(var a=new Uint8Array(t.length),e=0;e<t.length;e++)a[e]=t.charCodeAt(e);return a}function i(t){var a=[],e=t.length%8?new Array(9-t.length%8).join("0"):"";t=e+t;for(var r=0;r<t.length;r+=8)a.push(parseInt(t.substr(r,8),2));return new Uint8Array(a)}function o(t,a){for(var f=[],u=0;u<t.length;u++)if("id"in t[u]){var h=t[u].data;if("object"==typeof h&&(h=o(h,a)),"number"==typeof h&&(h="size"in t[u]?r(h,t[u].size):i(h.toString(2))),"string"==typeof h&&(h=n(h)),h.length);var c=h.size||h.byteLength||h.length,g=Math.ceil(Math.ceil(Math.log(c)/Math.log(2))/8),v=c.toString(2),l=new Array(7*g+7+1-v.length).join("0")+v,m=new Array(g).join("0")+"1"+l;f.push(e(t[u].id)),f.push(i(m)),f.push(h)}else f.push(t[u]);if(a){var p=d(f);return new Uint8Array(p)}return new Blob(f,{type:"video/webm"})}function d(t,a){null==a&&(a=[]);for(var e=0;e<t.length;e++)"object"==typeof t[e]?d(t[e],a):a.push(t[e]);return a}function h(t){var a=0;if(t.keyframe&&(a|=128),t.invisible&&(a|=8),t.lacing&&(a|=t.lacing<<1),t.discardable&&(a|=1),t.trackNum>127)throw"TrackNumber > 127 not supported";var e=[128|t.trackNum,t.timecode>>8,255&t.timecode,a].map(function(t){return String.fromCharCode(t)}).join("")+t.frame;return e}function s(t){for(var a=t.RIFF[0].WEBP[0],e=a.indexOf("Â*"),r=0,n=[];4>r;r++)n[r]=a.charCodeAt(e+3+r);var i,o,d,f,u;return u=n[1]<<8|n[0],i=16383&u,o=u>>14,u=n[3]<<8|n[2],d=16383&u,f=u>>14,{width:i,height:d,data:a,riff:t}}function c(t){for(var a=0,e={};a<t.length;){var r=t.substr(a,4);if(e[r]=e[r]||[],"RIFF"==r||"LIST"==r){var n=parseInt(t.substr(a+4,4).split("").map(function(t){var a=t.charCodeAt(0).toString(2);return new Array(8-a.length+1).join("0")+a}).join(""),2),i=t.substr(a+4+4,n);a+=8+n,e[r].push(c(i))}else"WEBP"==r?(e[r].push(t.substr(a+8)),a=t.length):(e[r].push(t.substr(a+4)),a=t.length)}return e}function g(t){return[].slice.call(new Uint8Array(new Float64Array([t]).buffer),0).map(function(t){return String.fromCharCode(t)}).reverse().join("")}function v(t,a){this.frames=[],this.duration=1e3/t,this.quality=a||.8}function p(t,a){var e=document.getElementsByTagName("head")[0],r=document.createElement("script");r.type="text/javascript",r.src=t,r.onreadystatechange=a,r.onload=a,e.appendChild(r)}function w(t){return m?t(m):void(l.test(document.createElement("canvas").toDataURL("image/webp"))?(m=function(t,a){return atob(t.toDataURL("image/webp",a).slice(23))},t(m)):p("libwebp-0.1.3.min.js",function(){m=function(t,a){var e={output:""},r=new WebPEncoder;config=new Object,config.target_size=3e6,config.target_PSNR=0,config.method=4,config.sns_strength=50,config.filter_strength=20,config.filter_sharpness=0,config.filter_type=1,config.partitions=0,config.segments=4,config.pass=2,config.show_compressed=0,config.preprocessing=0,config.autofilter=0,config.extra_info_type=0,config.preset=0,r.WebPEncodeConfig(config);{var n=t.width,i=t.height,o=t.getContext("2d").getImageData(0,0,n,i).data;r.WebPEncodeRGBA(o,n,i,4*n,a||.8,e)}str=r.ReturnExtraInfo();var f=e.output;return console.log(f),f},t(m)}))}var l=/^data:image\/webp;base64,/gi;v.prototype.add=function(t,a){if("undefined"!=typeof a&&this.duration)throw"you can't pass a duration if the fps is set";if("undefined"==typeof a&&!this.duration)throw"if you don't have the fps set, you need to have durations here.";if(t.canvas&&(t=t.canvas),t.toDataURL)t=t.getContext("2d").getImageData(0,0,t.width,t.height);else if("string"!=typeof t)throw"frame must be a a HTMLCanvasElement, a CanvasRenderingContext2D or a DataURI formatted string";if("string"==typeof t&&!l.test(t))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:t,duration:a||this.duration})};var m;return v.prototype.encodeFrames=function(t,a){if(this.frames[0].image instanceof ImageData){var e=this.frames,r=document.createElement("canvas"),n=r.getContext("2d");r.width=this.frames[0].image.width,r.height=this.frames[0].image.height;var i=function(o){a||console.log("encodeFrame",o);var d=e[o];w(function(f){n.putImageData(d.image,0,0),d.image=f(r,this.quality),a&&a(o,e.length),o<e.length-1?setTimeout(function(){i(o+1)},1):t()})}.bind(this);i(0)}else t()},v.prototype.compile=function(a,e,r){console.log("outputAsArray, callback, frame_done_cb : ",a,e,r),this.encodeFrames(function(){var r=new t(this.frames.map(function(t){var a=s(c(t.image));return console.log("frame duration : ",t.duration),a.duration=t.duration,a}),a);e(r)}.bind(this),r)},{Video:v,fromImageArray:function(a,e,r){return t(a.map(function(){var a=s(c(frame.image));return a.duration=1e3/e,a}),r)},toWebM:t}}();